# ═══════════════════════════════════════════════════════════════════════════
# Windows Backend API v4.0.3 HTTPS Configuration
# Location: C:\backend_api\config.env
# ═══════════════════════════════════════════════════════════════════════════

# ═══════════════════════════════════════════════════════════════════════════
# DATABASE CONFIGURATION
# ═══════════════════════════════════════════════════════════════════════════
DB_HOST=localhost
DB_PORT=5432
DB_NAME=redirector_db
DB_USER=redirector_user
DB_PASSWORD=YOUR_SECURE_PASSWORD_HERE

# ═══════════════════════════════════════════════════════════════════════════
# API CONFIGURATION
# ═══════════════════════════════════════════════════════════════════════════
# API Host (0.0.0.0 = listen on all interfaces)
API_HOST=0.0.0.0

# HTTP Port (used when ENABLE_HTTPS=false)
API_PORT=6921

# Authentication token (64 hex characters)
# Generate: python -c "import secrets; print(secrets.token_hex(32))"
API_TOKEN=YOUR_64_CHAR_HEX_TOKEN_HERE

# ═══════════════════════════════════════════════════════════════════════════
# HTTPS/TLS CONFIGURATION
# ═══════════════════════════════════════════════════════════════════════════

# Enable HTTPS (true/false)
# Set to 'true' to enable TLS/SSL encryption
# Set to 'false' for plain HTTP (development only)
ENABLE_HTTPS=true

# SSL Certificate Path (PEM format)
# Generated by: .\generate_ssl_cert.ps1
SSL_CERT_PATH=C:\backend_api\certs\backend_api_cert.pem

# SSL Private Key Path (PEM format)
# Extract from PFX: openssl pkcs12 -in backend_api.pfx -nocerts -out backend_api_key.pem -nodes
SSL_KEY_PATH=C:\backend_api\certs\backend_api_key.pem

# HTTPS Port
# Default: 6922 (different from HTTP port to allow both simultaneously)
SSL_PORT=6922

# Minimum TLS Version
# Options: TLS1_2 (recommended), TLS1_3 (most secure, may have compatibility issues)
SSL_MIN_VERSION=TLS1_2

# ═══════════════════════════════════════════════════════════════════════════
# SECURITY HEADERS
# ═══════════════════════════════════════════════════════════════════════════

# HTTP Strict Transport Security (HSTS)
# Forces browsers to use HTTPS for future connections
# Only effective when ENABLE_HTTPS=true
ENABLE_HSTS=true

# HSTS Max Age (seconds)
# 31536000 = 1 year (recommended)
# Browser will enforce HTTPS for this duration
HSTS_MAX_AGE=31536000

# ═══════════════════════════════════════════════════════════════════════════
# DEPLOYMENT MODES
# ═══════════════════════════════════════════════════════════════════════════

# DEVELOPMENT MODE:
#   ENABLE_HTTPS=false
#   API_PORT=6921
#   (Plain HTTP for local testing)

# PRODUCTION MODE (RECOMMENDED):
#   ENABLE_HTTPS=true
#   SSL_PORT=6922
#   SSL_MIN_VERSION=TLS1_2
#   ENABLE_HSTS=true
#   (Encrypted HTTPS with security headers)

# DUAL MODE (HTTP + HTTPS):
#   Run two instances:
#   - Instance 1: ENABLE_HTTPS=false, API_PORT=6921
#   - Instance 2: ENABLE_HTTPS=true, SSL_PORT=6922
#   (Allows migration period)

# ═══════════════════════════════════════════════════════════════════════════
# VPS L4 REDIRECTOR INTEGRATION
# ═══════════════════════════════════════════════════════════════════════════

# When ENABLE_HTTPS=true, configure VPS with:
#
# /etc/l4-redirector/config.env:
#   LOCALTONET_IP=YOUR_WINDOWS_IP
#   LOCALTONET_PORT=6922  # Match SSL_PORT
#   BACKEND_USE_HTTPS=true
#   BACKEND_VERIFY_SSL=false  # For self-signed certificates
#
# Test from VPS:
#   curl -k -H "Authorization: Bearer YOUR_TOKEN" \
#        https://YOUR_WINDOWS_IP:6922/health

# ═══════════════════════════════════════════════════════════════════════════
# CERTIFICATE MANAGEMENT
# ═══════════════════════════════════════════════════════════════════════════

# GENERATE SELF-SIGNED CERTIFICATE:
#   PowerShell (as Administrator):
#   .\generate_ssl_cert.ps1 -CertName "YOUR_WINDOWS_IP" -ValidDays 365
#
# EXTRACT PRIVATE KEY FROM PFX:
#   OpenSSL:
#   openssl pkcs12 -in C:\backend_api\certs\backend_api.pfx \
#                  -nocerts -out C:\backend_api\certs\backend_api_key.pem -nodes
#
# VERIFY CERTIFICATE:
#   openssl x509 -in C:\backend_api\certs\backend_api_cert.pem -text -noout
#
# CHECK EXPIRATION:
#   openssl x509 -in C:\backend_api\certs\backend_api_cert.pem -noout -enddate

# ═══════════════════════════════════════════════════════════════════════════
# SECURITY BEST PRACTICES
# ═══════════════════════════════════════════════════════════════════════════

# ✅ DO:
#   - Use HTTPS in production (ENABLE_HTTPS=true)
#   - Secure certificate files with restrictive permissions
#   - Use TLS 1.2 or higher (SSL_MIN_VERSION=TLS1_2)
#   - Enable HSTS (ENABLE_HSTS=true)
#   - Rotate certificates before expiration
#   - Use strong API tokens (64 hex characters)
#
# ❌ DON'T:
#   - Use HTTP in production
#   - Commit certificate files to version control
#   - Share private keys
#   - Use weak TLS versions (SSL3, TLS1.0, TLS1.1)
#   - Ignore certificate expiration warnings
#   - Use short/weak API tokens

# ═══════════════════════════════════════════════════════════════════════════
# TROUBLESHOOTING
# ═══════════════════════════════════════════════════════════════════════════

# Certificate not found:
#   - Run: .\generate_ssl_cert.ps1
#   - Verify paths: SSL_CERT_PATH and SSL_KEY_PATH
#
# Connection refused:
#   - Check firewall: netsh advfirewall firewall show rule name="Backend API HTTPS"
#   - Verify service is running: Get-Service BackendAPIv4
#   - Check port binding: netstat -ano | findstr 6922
#
# SSL handshake errors:
#   - Verify certificate validity: openssl x509 -in cert.pem -noout -dates
#   - Check TLS version compatibility
#   - Test with: curl -vk https://localhost:6922/health
#
# VPS can't connect:
#   - Test from VPS: curl -k https://YOUR_WINDOWS_IP:6922/health
#   - Check LocalToNet/WireGuard tunnel
#   - Verify BACKEND_VERIFY_SSL=false on VPS for self-signed certs
#   - Check firewall rules on both Windows and VPS

# ═══════════════════════════════════════════════════════════════════════════
# END OF CONFIGURATION
# ═══════════════════════════════════════════════════════════════════════════
