name: ðŸ¤– AI-Powered Development & Self-Improvement

# Automated AI-powered development system that continuously improves the project
# Uses all 9 API keys with intelligent fallback for maximum reliability

on:
  push:
    branches: [ main, develop ]
  pull_request:
    types: [ opened, synchronize, reopened ]
  schedule:
    # Run every 6 hours for continuous improvement
    - cron: '0 */6 * * *'
  workflow_dispatch:
    inputs:
      improvement_type:
        description: 'Type of improvement'
        required: true
        default: 'comprehensive'
        type: choice
        options:
          - comprehensive
          - code_quality
          - documentation
          - performance
          - security
          - architecture

env:
  PYTHON_VERSION: '3.11'
  
  # All 15 AI API Keys for Ultimate Failover (Your Actual API Keys)
  # Tier 1 - Premium Speed (Priority 1-2)
  CEREBRAS_API_KEY: ${{ secrets.CEREBRAS_API_KEY }}
  NVIDIA_API_KEY: ${{ secrets.NVIDIA_API_KEY }}
  GROQ2_API_KEY: ${{ secrets.GROQ2_API_KEY }}
  GROQAI_API_KEY: ${{ secrets.GROQAI_API_KEY }}
  
  # Tier 2 - High Quality (Priority 3-5)
  DEEPSEEK_API_KEY: ${{ secrets.DEEPSEEK_API_KEY }}
  CODESTRAL_API_KEY: ${{ secrets.CODESTRAL_API_KEY }}
  GLM_API_KEY: ${{ secrets.GLM_API_KEY }}
  GEMINI2_API_KEY: ${{ secrets.GEMINI2_API_KEY }}
  GROK_API_KEY: ${{ secrets.GROK_API_KEY }}
  
  # Tier 3 - Enterprise (Priority 6)
  COHERE_API_KEY: ${{ secrets.COHERE_API_KEY }}
  
  # Tier 4 - Reliable Fallbacks (Priority 7-10)
  KIMI_API_KEY: ${{ secrets.KIMI_API_KEY }}
  QWEN_API_KEY: ${{ secrets.QWEN_API_KEY }}
  GPTOSS_API_KEY: ${{ secrets.GPTOSS_API_KEY }}
  CHUTES_API_KEY: ${{ secrets.CHUTES_API_KEY }}

jobs:
  ai_project_analysis:
    name: ðŸ” AI Project Analysis
    runs-on: ubuntu-latest
    timeout-minutes: 30
    
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
      
      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: ${{ env.PYTHON_VERSION }}
          cache: 'pip'
      
      - name: Install Dependencies
        run: |
          python -m pip install --upgrade pip setuptools wheel
          pip install --prefer-binary -r requirements.txt
          pip install groq google-generativeai cerebras-cloud-sdk
      
      - name: Analyze Project with AI
        id: analysis
        run: |
          python .github/scripts/ai_project_analyzer.py \
            --mode comprehensive \
            --output analysis_results.json \
            --use-all-providers
      
      - name: Upload Analysis Results
        uses: actions/upload-artifact@v4
        with:
          name: ai-analysis-results
          path: analysis_results.json

  ai_code_improvement:
    name: âœ¨ AI Code Improvement
    runs-on: ubuntu-latest
    needs: ai_project_analysis
    timeout-minutes: 45
    
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          token: ${{ secrets.GITHUB_TOKEN }}
      
      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: ${{ env.PYTHON_VERSION }}
          cache: 'pip'
      
      - name: Install Dependencies
        run: |
          python -m pip install --upgrade pip setuptools wheel
          pip install --prefer-binary -r requirements.txt
          pip install groq google-generativeai cerebras-cloud-sdk
      
      - name: Download Analysis Results
        uses: actions/download-artifact@v4
        with:
          name: ai-analysis-results
      
      - name: Generate Improvements with AI
        id: improvements
        run: |
          python .github/scripts/ai_improvement_generator.py \
            --input analysis_results.json \
            --output improvements.json \
            --type ${{ inputs.improvement_type || 'comprehensive' }} \
            --use-all-providers
      
      - name: Apply Improvements
        id: apply
        run: |
          python .github/scripts/ai_automated_implementer.py \
            --input improvements.json \
            --auto-apply false \
            --create-pr true \
            --use-all-providers
      
      - name: Upload Improvements
        uses: actions/upload-artifact@v4
        with:
          name: ai-improvements
          path: improvements.json

  ai_documentation_update:
    name: ðŸ“š AI Documentation Update
    runs-on: ubuntu-latest
    needs: ai_code_improvement
    timeout-minutes: 20
    
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
      
      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: ${{ env.PYTHON_VERSION }}
          cache: 'pip'
      
      - name: Install Dependencies
        run: |
          python -m pip install --upgrade pip setuptools wheel
          pip install --prefer-binary -r requirements.txt
          pip install groq google-generativeai
      
      - name: Update Documentation with AI
        run: |
          python .github/scripts/ai_documentation_updater.py \
            --mode comprehensive \
            --use-all-providers
      
      - name: Commit Documentation Updates
        if: github.event_name != 'pull_request'
        run: |
          git config --local user.email "ai-developer@amas.ai"
          git config --local user.name "AI Developer"
          git add docs/ README.md *.md
          git diff --staged --quiet || git commit -m "ðŸ“š AI-powered documentation update [skip ci]"
          git push

  ai_security_audit:
    name: ðŸ”’ AI Security Audit
    runs-on: ubuntu-latest
    needs: ai_project_analysis
    timeout-minutes: 25
    
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
      
      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: ${{ env.PYTHON_VERSION }}
          cache: 'pip'
      
      - name: Install Dependencies
        run: |
          python -m pip install --upgrade pip setuptools wheel
          pip install --prefer-binary -r requirements.txt
          pip install groq google-generativeai
      
      - name: Run Security Audit with AI
        run: |
          python .github/scripts/ai_security_auditor.py \
            --mode comprehensive \
            --use-all-providers \
            --output security_audit.json
      
      - name: Upload Security Audit
        uses: actions/upload-artifact@v4
        with:
          name: security-audit
          path: security_audit.json

  final_summary:
    name: ðŸ“Š Final Summary
    runs-on: ubuntu-latest
    needs: [ai_code_improvement, ai_documentation_update, ai_security_audit]
    if: always()
    
    steps:
      - name: Generate Summary
        run: |
          echo "## ðŸ¤– AI-Powered Development Summary" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "âœ… All AI-powered development tasks completed" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### Providers Used (All 16 Available):" >> $GITHUB_STEP_SUMMARY
          echo "- Tier 1: Cerebras, NVIDIA, Groq AI" >> $GITHUB_STEP_SUMMARY
          echo "- Tier 2: DeepSeek, GLM, Grok, Gemini, Gemini2" >> $GITHUB_STEP_SUMMARY
          echo "- Tier 3: Claude, GPT-4, Codestral, Cohere" >> $GITHUB_STEP_SUMMARY
          echo "- Tier 4: Kimi, Qwen, GPT OSS, Groq2, Chutes" >> $GITHUB_STEP_SUMMARY


